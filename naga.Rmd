---
title: "The Associations Between Mismanaged Plastic Waste and Per Capita GDP and Coastal Populations"
author: "Nagaprasad Rudrapatna"
date: "December 16, 2022"
output:
  pdf_document:
    number_sections: yes
header-includes:
- \usepackage{float}
- \floatplacement{figure}{H}
---

```{r setup, include = FALSE}
library(tidyverse)
library(naniar)
library(UpSetR)
library(betareg)
library(janitor)
library(broom)
library(knitr)
opts_chunk$set(echo = FALSE, include = FALSE, warning = FALSE, message = FALSE)
```

```{r}
coast_vs_waste <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-21/coastal-population-vs-mismanaged-plastic.csv") %>%
  select(-`Mismanaged plastic waste (tonnes)`) %>%
  filter(Year == '2010') %>%
  filter(Entity != "World")

mismanaged_vs_gdp <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-21/per-capita-mismanaged-plastic-waste-vs-gdp-per-capita.csv") %>%
  filter(Year == '2010')

waste_vs_gdp <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-21/per-capita-plastic-waste-vs-gdp-per-capita.csv") %>%
  select(Entity, Code, Year, `Per capita plastic waste (kilograms per person per day)`, `Total population (Gapminder)`) %>%
  filter(Year == '2010')

exclude <- c("Arab World", "Caribbean small states", "Central Europe and the Baltics", "Early-demographic dividend", "East Asia & Pacific", "East Asia & Pacific (IDA & IBRD)", "East Asia & Pacific (excluding high income)", "Europe and Central Asia", "Europe and Central Asia (IDA & IBRD)", "Europe and Central Asia (excluding high income)", "European Union", "Fragile and conflict affected situations", "Heavily indebted poor countries (IPC)", "High income", "IBRD only", "IDA and IBRD total", "IDA blend", "IDA only", "IDA total", "Late-demographic dividend", "Latin America & Caribbean", "Latin America & Caribbean (IDA & IBRD)", "Latin America & Caribbean (excluding high income)", "Least developed countries: UN classification", "Low & middle income", "Low income", "Lower middle income", "Middle East & North Africa", "Middle East & North Africa (IDA & IBRD)", "Middle East & North Africa (excluding high income)", "Middle income", "OECD members", "Other small states", "Pacific island small states", "Post-demographic dividend", "Pre-demographic dividend", "Small states", "South Asia", "South Asia (IDA & IBRD)", "Sub-Saharan Africa", "Sub-Saharan Africa (IDA & IBRD)", "Sub-Saharan Africa (excluding high income)", "Upper middle income", "World", "Euro area", "Europe & Central Asia", "Europe & Central Asia (IDA & IBRD)", "Europe & Central Asia (excluding high income)", "Heavily indebted poor countries (HIPC)", "IDA & IBRD total", "North America", "Kosovo", "Timor")

plastic <- left_join(mismanaged_vs_gdp, waste_vs_gdp, by = c('Entity', 'Code', 'Year', 'Total population (Gapminder)')) %>%
  filter(!(Entity %in% exclude))

plastic <- plastic %>%
  mutate(`Coastal Population` = coast_vs_waste$`Coastal population`) %>%
  rename("Country" = "Entity",
         "Total Population" = "Total population (Gapminder)",
         "Per Capita GDP" = "GDP per capita, PPP (constant 2011 international $) (Rate)",
         "Per Capita Mismanaged Waste (Per Day)" = "Per capita mismanaged plastic waste (kilograms per person per day)",
         "Per Capita Waste (Per Day)" = "Per capita plastic waste (kilograms per person per day)") %>%
  select(-Code)
```

```{r}
vis_miss(plastic, warn_large_data = F)
gg_miss_upset(plastic)
```

```{r}
plastic2 <- plastic %>%
  filter(!is.na(`Total Population`)) %>% # 11 excluded
  filter(!is.na(`Per Capita GDP`)) %>% # 38 excluded
  filter(!is.na(`Per Capita Mismanaged Waste (Per Day)`) & !is.na(`Per Capita Waste (Per Day)`)) %>% # 40 excluded
  mutate(`Mismanaged Waste Proportion` = `Per Capita Mismanaged Waste (Per Day)` / `Per Capita Waste (Per Day)`) %>%
  mutate(`Coastal Population Proportion` = ifelse(`Coastal Population` / `Total Population` < 1, `Coastal Population` / `Total Population`, 1)) %>% # when coastal population > total population, we consider the entire population to be coastal (islands)
  select(Country, `Per Capita GDP`, `Coastal Population Proportion`, `Coastal Population`, `Total Population`, `Mismanaged Waste Proportion`)
```

# Introduction

## Background Information

Plastic pollution is a severe and growing problem in the world, adversely affecting ecosystems and wildlife. According to Geyer and collaborators (2017), the world produced only two million tonnes of plastic. Since then, annual global plastic production has increased roughly 150-fold, reaching 313 million tonnes in 2010 (this upward trend has continued: approximately 460 million tonnes in 2019; Ritchie & Roser, 2018). Naturally, as plastic production has amplified across several decades, plastic waste generation has also increased. Increased plastic waste, by itself, is not the primary issue. The problem is that many (particularly, low-to-middle income) countries continue to rely on inefficient waste management systems which cannot cope with increasing waste generation (Ritchie & Roser, 2018). This has contributed to an increase in the amount of mismanaged plastic waste--plastic that is either inadequately disposed (stored in open or insecure landfills; high risk of polluting rivers and oceans) or littered by coastal populations (populations living within 50 kilometers of a coastline)--generated globally (Ritchie & Roser, 2018). Coastal populations are critical because their plastic waste is at a higher risk of leading to ocean debris (compared to sources further inland), but “mismanaged waste could eventually enter the ocean via inland waterways, wastewater outflows, and transport by wind or tides” (Ritchie & Roser, 2018). 

## Research Aims

How is a country's per capita GDP associated with its proportion of mismanaged plastic waste?

How is a country's coastal population proportion (Number of individuals living on/near coast / total population) associated with its proportion of mismanaged plastic waste?

## Data Description and Key Variables

## Hypotheses

## Exploratory Data Analysis

```{r}
ggplot(data = plastic2, mapping = aes(x = `Per Capita GDP`, y = `Mismanaged Waste Proportion`)) +
  geom_point()

ggplot(data = plastic2, mapping = aes(x = `Per Capita GDP`, y = log(`Mismanaged Waste Proportion`))) +
  geom_point() # negative trend after log-transformation

ggplot(data = plastic2, mapping = aes(x = `Coastal Population`, y = `Mismanaged Waste Proportion`)) +
  geom_point()

ggplot(data = plastic2, mapping = aes(x = `Total Population`, y = `Mismanaged Waste Proportion`)) +
  geom_point()

ggplot(data = plastic2, mapping = aes(x = `Coastal Population Proportion`, y = `Mismanaged Waste Proportion`)) +
  geom_point() # no relationship
```

```{r}
bm1 <- betareg(`Mismanaged Waste Proportion` ~ `Per Capita GDP`, data = plastic2)

bm2 <- betareg(`Mismanaged Waste Proportion` ~ `Per Capita GDP` + `Coastal Population Proportion`, data = plastic2)

lm1 <- lm(log(`Mismanaged Waste Proportion`) ~ `Per Capita GDP`, data = plastic2)

lm2 <- lm(log(`Mismanaged Waste Proportion`) ~ `Per Capita GDP` + `Coastal Population Proportion`, data = plastic2)

summary(bm1)
summary(bm2)
summary(lm1)
summary(lm2)
```

# Methodology

conduct a complete case analysis (first exclude non-countries, then exclude countries without full information - Kosovo, Timor (island; East Timor - sovereign, West Timor part of Indonesia) excluded for lack of population data)
- response variable is created from mismanaged and total plastic waste
- per capita GDP (based on 2011 international rates) and proportion of country's coastal population to total population (reported by Gapminder) are covariates of interest

-> only consider 2010 since that's when plastic waste data is available
-> create response variable: Per Capita Mismanaged Waste (Per Day) / Per Capita Waste (Per Day)
-> create second covariate: Coastal Population / Total Population

-> tried to manually adjust total population for countries whose coastal population > total population, but found that the issue persisted for some countries
- issues with data collection of coastal population (how is it collected?)

response variable: between [0, 1]
beta regression! - not a GLM

- logit link
- Y ~ Beta(Alpha, Beta)
- logit(E(Y|X)) = X' beta
- log(Alpha / Beta) = X' beta
- Y = ratio of mismanaged to total plastic waste
- no error term

- interpretations: linear predictor of logit of conditional expectation
- why use logit link? - interpretability
- interactions -> no because interpreting quantitative-quantitative interactions is difficult, not aligned with objective

- assumptions for beta regression? - independence (only 2010 -> satisfied), linearity of predictors

Using mathematical notation, we can express our final model as

```{=tex}
\begin{align*}
\log(T_i) &= \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + \beta_3 x_{3i} +  \beta_4 x_{4i} + \beta_5 x_{5i} + \beta_6 x_{6i}  + \beta_7 x_{7i} + \beta_8 x_{8i} + \ldots + \beta_{30} x_{30i} + \epsilon_i
\end{align*}
```

where $i$ is the index for the patient (ranging from 1 to 21,180), $T_i$ is the predicted survival time of $i$th patient with a history of smoking. In terms of the covariates, $x_{1i}$ through $x_{3i}$ indicate the $i$th patient’s body mass index category, $x_{4i}$ through $x_{7i}$ indicate the $i$th patient’s congestive heart failure severity, and $x_{8i}$ through $x_{30i}$ are the controlled patient demographic and medical factors.

# Results

The regression coefficients were estimated using the `betareg()` function in R. Table 2 displays the coefficient estimates, as well as the corresponding 95% confidence intervals and p-values for the final model.


```{r include = T}
final_output <- clean_names(as.data.frame(summary(bm2)[["coefficients"]][["mean"]])) %>%
  mutate(conf_int_lower = (estimate - (1.96*std_error)),
         conf_int_upper = (estimate + (1.96*std_error))) %>%
  select(estimate, conf_int_lower, conf_int_upper, pr_z) %>%
  mutate(p = if_else(pr_z < 0.01, 0.00, pr_z),
         p = ceiling(p * 10000) / 10000,
         p = as.character(p),
         p = if_else(p == "0", "<0.01", p)) %>%
  rename("Coefficient" = estimate,
         "Lower Bound" = conf_int_lower,
         "Upper Bound" = conf_int_upper,
         "P-Value" = p) %>%
  select(-pr_z)

final_output %>%
  kable(digits = 3, caption = "Final Model Coefficients and 95% Confidence Intervals")
```

Holding the proportion of a country's total population that lives within 50 kilometers of a coastline constant:

# Discussion

## Conclusions

## Limitations and Future Directions

## Summary

# Appendices

# References

1) Geyer et al., 2017: Production, use, and fate of all plastics ever made | Science Advances

2) Hannah Ritchie and Max Roser (2018) - "Plastic Pollution". Published online at OurWorldInData.org. Retrieved from: 'https://ourworldindata.org/plastic-pollution' [Online Resource]


https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-05-21

